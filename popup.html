<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerspectiveLens</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=local_cafe" />
    <link rel="stylesheet" href="ui/design-system.css">
    <link rel="stylesheet" href="ui/pages/popup/popup.css">
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <h1 class="title">PerspectiveLens</h1>
      <button id="settings-btn" class="icon-btn" title="Settings" aria-label="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </button>
    </header>

    <!-- Main Content -->
    <main class="content">
      <!-- AI Model Selection -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">AI Model</h2>
          <button id="refresh-status" class="icon-btn-small" title="Refresh status" aria-label="Refresh status">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 2V8M21 8H15M21 8L18 5.5C16.5 4 14.5 3 12 3C7 3 3 7 3 12C3 17 7 21 12 21C15.5 21 18.5 19 20 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <!-- Model Selector Tabs -->
        <div class="model-tabs">
          <button id="tab-nano" class="model-tab" data-model="nano">
            <span class="tab-label">Gemini Nano</span>
            <span class="tab-badge">Local</span>
          </button>
          <button id="tab-api" class="model-tab active" data-model="api">
            <span class="tab-label">API Models</span>
            <span class="tab-badge">Cloud</span>
          </button>
        </div>

        <!-- Gemini Nano Status Card -->
        <div id="nano-card" class="status-card" style="display: none;">
          <div class="status-row">
            <span class="status-label">Status</span>
            <div class="status-with-action">
              <div class="status-value" id="nano-status">
                <span class="spinner"></span>
                <span>Checking...</span>
              </div>
            </div>
          </div>

          <!-- Download Progress (hidden by default) -->
          <div class="progress-container" id="nano-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="nano-progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-info">
              <span id="nano-progress-percent">0%</span>
              <span id="nano-progress-size">0 MB / 1.7 GB</span>
            </div>
          </div>

          <!-- Download Button (hidden by default) -->
          <button id="nano-download-btn" class="btn-primary" style="display: none;">
            Download AI Model
          </button>
        </div>

        <!-- API Models Status Card -->
        <div id="api-card" class="status-card">
          <div class="status-row">
            <span class="status-label">Status</span>
            <div class="status-with-action">
              <div class="status-value" id="api-status">
                <span>Checking...</span>
                <span class="spinner"></span>
              </div>
            </div>
          </div>

          <!-- API Key Not Configured (hidden by default) -->
          <div id="api-key-input" class="api-key-input" style="display: none;">
            <label for="api-key" class="input-label">API Key</label>
            <div class="input-wrapper">
              <input
                type="password"
                id="api-key"
                class="text-input"
                placeholder="AIza..."
                autocomplete="off"
              >
              <button id="toggle-visibility" class="input-icon-btn" title="Show/Hide">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5C7 5 2.73 8.11 1 12.5 2.73 16.89 7 20 12 20s9.27-3.11 11-7.5C21.27 8.11 17 5 12 5zm0 12.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" fill="currentColor"/>
                </svg>
              </button>
            </div>

            <div class="button-row">
              <button id="save-key-btn" class="btn-primary">
                Save Key
              </button>
              <a
                href="https://aistudio.google.com/apikey"
                target="_blank"
                class="btn-link"
                rel="noopener noreferrer"
              >
                Get API Key
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z" fill="currentColor"/>
                </svg>
              </a>
            </div>

            <!-- Validation Message -->
            <div id="validation-msg" class="validation-message" style="display: none;"></div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <a href="https://github.com/IvanAmador/PerspectiveLens" target="_blank" class="footer-link" rel="noopener noreferrer">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 19C4 20.5 4 16.5 2 16M16 22V18.13C16.0375 17.6532 15.9731 17.1738 15.811 16.7238C15.6489 16.2738 15.3929 15.8634 15.06 15.52C18.2 15.17 21.5 13.98 21.5 8.52C21.4997 7.12383 20.9627 5.7812 20 4.77C20.4559 3.54851 20.4236 2.19835 19.91 1C19.91 1 18.73 0.65 16 2.48C13.708 1.85882 11.292 1.85882 9 2.48C6.27 0.65 5.09 1 5.09 1C4.57638 2.19835 4.54414 3.54851 5 4.77C4.03013 5.7887 3.49252 7.14346 3.5 8.55C3.5 13.97 6.8 15.16 9.94 15.55C9.611 15.89 9.35726 16.2954 9.19531 16.7399C9.03335 17.1844 8.96681 17.6581 9 18.13V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>GitHub</span>
      </a>
      <a href="https://www.paypal.com/donate/?business=PRGXQ9GA6WQ9C&no_recurring=0&currency_code=BRL" target="_blank" class="footer-link" rel="noopener noreferrer">
        <span class="material-symbols-outlined" style="font-size: 16px;">local_cafe</span>
        <span>Donate</span>
      </a>
    </footer>

    <!-- Setup Modal (shown when Chrome flags are disabled) -->
    <div id="setup-modal" class="modal-overlay" style="display: none;">
      <div class="modal-card">
        <!-- Modal Header -->
        <div class="modal-header">
          <h2 class="modal-title">Enable Chrome AI Features</h2>
          <button id="close-modal-btn" class="icon-btn-small" title="Close" aria-label="Close modal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <!-- Modal Content -->
        <div class="modal-content">
          <p class="modal-description">
            Enable these 3 Chrome flags to use Gemini Nano for on-device AI analysis:
          </p>

          <!-- Flag Cards -->
          <div class="flags-container">
            <!-- Flag 1: Prompt API -->
            <div class="flag-card">
              <div class="flag-header">
                <div class="flag-number">1</div>
                <div class="flag-info">
                  <h3 class="flag-title">Prompt API</h3>
                  <p class="flag-description">Enables Gemini Nano for comparative analysis</p>
                </div>
              </div>
              <div class="flag-url-container">
                <code class="flag-url" id="flag-url-1">#prompt-api-for-gemini-nano</code>
                <button class="copy-btn" data-flag-id="1" title="Copy flag URL">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 4V16C8 16.5304 8.21071 17.0391 8.58579 17.4142C8.96086 17.7893 9.46957 18 10 18H18C18.5304 18 19.0391 17.7893 19.4142 17.4142C19.7893 17.0391 20 16.5304 20 16V7.242C20 6.97556 19.9467 6.71181 19.8433 6.46624C19.7399 6.22068 19.5885 5.99824 19.398 5.812L16.083 2.57C15.7094 2.20466 15.2076 2.00007 14.685 2H10C9.46957 2 8.96086 2.21071 8.58579 2.58579C8.21071 2.96086 8 3.46957 8 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 18V20C16 20.5304 15.7893 21.0391 15.4142 21.4142C15.0391 21.7893 14.5304 22 14 22H6C5.46957 22 4.96086 21.7893 4.58579 21.4142C4.21071 21.0391 4 20.5304 4 20V9C4 8.46957 4.21071 7.96086 4.58579 7.58579C4.96086 7.21071 5.46957 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="flag-value">Set to: <strong>Enabled</strong></div>
            </div>

            <!-- Flag 2: Optimization Guide -->
            <div class="flag-card">
              <div class="flag-header">
                <div class="flag-number">2</div>
                <div class="flag-info">
                  <h3 class="flag-title">Optimization Guide</h3>
                  <p class="flag-description">Enables model download (bypass performance requirements)</p>
                </div>
              </div>
              <div class="flag-url-container">
                <code class="flag-url" id="flag-url-2">#optimization-guide-on-device-model</code>
                <button class="copy-btn" data-flag-id="2" title="Copy flag URL">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 4V16C8 16.5304 8.21071 17.0391 8.58579 17.4142C8.96086 17.7893 9.46957 18 10 18H18C18.5304 18 19.0391 17.7893 19.4142 17.4142C19.7893 17.0391 20 16.5304 20 16V7.242C20 6.97556 19.9467 6.71181 19.8433 6.46624C19.7399 6.22068 19.5885 5.99824 19.398 5.812L16.083 2.57C15.7094 2.20466 15.2076 2.00007 14.685 2H10C9.46957 2 8.96086 2.21071 8.58579 2.58579C8.21071 2.96086 8 3.46957 8 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 18V20C16 20.5304 15.7893 21.0391 15.4142 21.4142C15.0391 21.7893 14.5304 22 14 22H6C5.46957 22 4.96086 21.7893 4.58579 21.4142C4.21071 21.0391 4 20.5304 4 20V9C4 8.46957 4.21071 7.96086 4.58579 7.58579C4.96086 7.21071 5.46957 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="flag-value">Set to: <strong>Enabled BypassPerfRequirement</strong></div>
            </div>

            <!-- Flag 3: Summarization API -->
            <div class="flag-card">
              <div class="flag-header">
                <div class="flag-number">3</div>
                <div class="flag-info">
                  <h3 class="flag-title">Summarization API</h3>
                  <p class="flag-description">Enables article compression</p>
                </div>
              </div>
              <div class="flag-url-container">
                <code class="flag-url" id="flag-url-3">#summarization-api-for-gemini-nano</code>
                <button class="copy-btn" data-flag-id="3" title="Copy flag URL">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 4V16C8 16.5304 8.21071 17.0391 8.58579 17.4142C8.96086 17.7893 9.46957 18 10 18H18C18.5304 18 19.0391 17.7893 19.4142 17.4142C19.7893 17.0391 20 16.5304 20 16V7.242C20 6.97556 19.9467 6.71181 19.8433 6.46624C19.7399 6.22068 19.5885 5.99824 19.398 5.812L16.083 2.57C15.7094 2.20466 15.2076 2.00007 14.685 2H10C9.46957 2 8.96086 2.21071 8.58579 2.58579C8.21071 2.96086 8 3.46957 8 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 18V20C16 20.5304 15.7893 21.0391 15.4142 21.4142C15.0391 21.7893 14.5304 22 14 22H6C5.46957 22 4.96086 21.7893 4.58579 21.4142C4.21071 21.0391 4 20.5304 4 20V9C4 8.46957 4.21071 7.96086 4.58579 7.58579C4.96086 7.21071 5.46957 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="flag-value">Set to: <strong>Enabled</strong></div>
            </div>
          </div>

          <!-- Instructions -->
          <div class="instructions-card">
            <div class="instruction-step">
              <div class="instruction-number">4</div>
              <div class="instruction-text">
                <strong>Restart Chrome</strong> after enabling all flags
              </div>
            </div>
            <p class="instruction-note">
              Gemini Nano will download automatically in the background (~1.7 GB). This may take 5-10 minutes.
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="modal-actions">
            <button id="open-flags-btn" class="btn-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z" fill="currentColor"/>
              </svg>
              Open Chrome Flags
            </button>
          </div>

          <!-- Troubleshooting -->
          <details class="troubleshooting">
            <summary class="troubleshooting-title">Troubleshooting</summary>
            <div class="troubleshooting-content">
              <p>If models do not download automatically:</p>
              <ul>
                <li>Wait 1-2 minutes after restart for download to start</li>
                <li>Check status at <a href="chrome://on-device-internals/" target="_blank">chrome://on-device-internals/</a></li>
                <li>Ensure you have 22GB+ free storage and unmetered connection</li>
                <li>Try disabling and re-enabling the flags</li>
              </ul>
            </div>
          </details>
        </div>
      </div>
    </div>

    <script src="ui/theme-manager.js"></script>
    <script src="ui/pages/popup/popup.js" type="module"></script>
  </body>
</html>
