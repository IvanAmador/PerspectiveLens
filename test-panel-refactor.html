<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerspectiveLens Panel Refactor Test</title>
    <link rel="stylesheet" href="ui/design-system.css">
    <link rel="stylesheet" href="ui/components/panel/panel-styles.css">
    <style>
        body {
            font-family: var(--font-family-base);
            padding: 20px;
            background: var(--md-sys-color-surface-container);
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-button);
            cursor: pointer;
            font-family: var(--font-family-base);
        }
        
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>PerspectiveLens Panel Refactor Test</h1>
        <p>This page tests the refactored panel UI with improved design and professional styling.</p>
        
        <div class="test-buttons">
            <button onclick="openPanel()">Open Panel</button>
            <button onclick="simulateStage1()">Stage 1 (Context)</button>
            <button onclick="simulateStage2()">Stage 2 (Facts)</button>
            <button onclick="simulateStage3()">Stage 3 (Disputes)</button>
            <button onclick="simulateStage4()">Stage 4 (Perspectives)</button>
            <button onclick="showComplete()">Show Complete</button>
            <button onclick="resetPanel()">Reset</button>
        </div>
    </div>

    <!-- Panel HTML - This simulates what would be injected by the panel loader -->
    <div id="perspectivelens-panel" class="pl-panel">
      <div class="pl-panel-header">
        <div class="pl-panel-header-top">
          <div class="pl-panel-title">
            <span>PerspectiveLens</span>
          </div>
          <div class="pl-panel-actions">
            <button id="pl-close-btn" class="pl-btn-icon" aria-label="Close panel" title="Close">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
          </div>
        </div>
        <div class="pl-panel-subtitle">Comparative news analysis</div>
      </div>

      <div class="pl-panel-body">
        <!-- Stage Progress Indicator -->
        <div class="pl-stage-progress">
          <div class="pl-stage-indicator" data-stage="1">
            <div class="pl-stage-dot"></div>
            <div class="pl-stage-label">Context</div>
          </div>
          <div class="pl-stage-indicator" data-stage="2">
            <div class="pl-stage-dot"></div>
            <div class="pl-stage-label">Facts</div>
          </div>
          <div class="pl-stage-indicator" data-stage="3">
            <div class="pl-stage-dot"></div>
            <div class="pl-stage-label">Disputes</div>
          </div>
          <div class="pl-stage-indicator" data-stage="4">
            <div class="pl-stage-dot"></div>
            <div class="pl-stage-label">Perspectives</div>
          </div>
        </div>

        <!-- Loading State -->
        <div id="pl-loading" class="pl-state" style="display: none;">
          <div class="pl-spinner"></div>
          <p>Analyzing perspectives...</p>
        </div>

        <!-- Error State -->
        <div id="pl-error" class="pl-state pl-state-error" style="display: none;">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
          <p id="pl-error-message">An error occurred</p>
          <button id="pl-retry-btn" class="pl-btn-link">Retry analysis</button>
        </div>

        <!-- Analysis Content -->
        <div id="pl-content" class="pl-content" style="display: none;"></div>
      </div>
    </div>

    <script>
        // Mock the PerspectiveLensPanel global object for testing
        window.PerspectiveLensPanel = {
            show: function() {
                document.getElementById('perspectivelens-panel').classList.add('pl-panel-visible');
            },
            hide: function() {
                document.getElementById('perspectivelens-panel').classList.remove('pl-panel-visible');
            },
            showAnalysisProgressive: function(stage, stageData, perspectives) {
                // Simulate panel behavior
                console.log(`Stage ${stage} data:`, stageData);
                
                // Update stage indicators 
                updateStageIndicator(stage, 'completed');
                if (stage < 4) {
                    updateStageIndicator(stage + 1, 'active');
                }
                
                // Update content
                const content = document.getElementById('pl-content');
                if (stage === 1) {
                    content.innerHTML = '';
                    content.style.display = 'block';
                }
                
                // Add sample content based on stage
                const stageDiv = document.createElement('div');
                stageDiv.className = 'pl-section';
                stageDiv.id = `pl-stage-${stage}`;
                
                if (stage === 1) {
                    stageDiv.innerHTML = `
                        <div class="pl-card pl-card-summary">
                            <h3 class="pl-card-title">Story Summary</h3>
                            <p class="pl-main-story">This is a simulated main story summary showing the key point of the news article.</p>
                            <div class="pl-trust-signal">
                                <div class="pl-trust-header">
                                    <span class="pl-trust-label">High Agreement</span>
                                </div>
                                <p class="pl-trust-description">Coverage is largely consistent across multiple sources</p>
                            </div>
                            <div class="pl-reader-action">
                                <strong>What to watch for:</strong> Pay attention to potential bias in the sources.
                            </div>
                        </div>
                    `;
                } else if (stage === 2) {
                    stageDiv.innerHTML = `
                        <div class="pl-section">
                            <h3 class="pl-section-title">
                                Consensus Facts
                                <span class="pl-badge">3</span>
                            </h3>
                            <p class="pl-section-desc">Facts multiple sources agree on</p>
                            <div class="pl-list">
                                <div class="pl-list-item">
                                    <p class="pl-list-item-title">Fact 1: This is a fact that multiple sources agree on</p>
                                    <div class="pl-list-item-meta">
                                        <span>3 sources</span>
                                        <span class="pl-tag-source pl-tag-link">Source A</span>
                                        <span class="pl-tag-source pl-tag-link">Source B</span>
                                        <span class="pl-tag-source pl-tag-link">Source C</span>
                                    </div>
                                </div>
                                <div class="pl-list-item">
                                    <p class="pl-list-item-title">Fact 2: This is another fact that all sources confirm</p>
                                    <div class="pl-list-item-meta">
                                        <span>4 sources</span>
                                        <span class="pl-tag-source pl-tag-link">Source A</span>
                                        <span class="pl-tag-source pl-tag-link">Source B</span>
                                        <span class="pl-tag-source pl-tag-link">Source D</span>
                                        <span class="pl-tag-source pl-tag-link">Source E</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (stage === 3) {
                    stageDiv.innerHTML = `
                        <div class="pl-section">
                            <h3 class="pl-section-title">
                                Factual Disputes
                                <span class="pl-badge">1</span>
                            </h3>
                            <p class="pl-section-desc">Direct contradictions - verify with additional sources</p>
                            <div class="pl-list">
                                <div class="pl-list-item">
                                    <p class="pl-list-item-title">Disputed claim about the event timeline</p>
                                    <div class="pl-dispute-claims">
                                        <div class="pl-claim">
                                            <div class="pl-claim-text">The event occurred at 3 PM local time</div>
                                            <div class="pl-claim-sources">
                                                <span class="pl-tag-source pl-tag-link">Source A</span>
                                                <span class="pl-tag-source pl-tag-link">Source B</span>
                                            </div>
                                        </div>
                                        <div class="pl-claim">
                                            <div class="pl-claim-text">The event occurred at 5 PM local time</div>
                                            <div class="pl-claim-sources">
                                                <span class="pl-tag-source pl-tag-link">Source C</span>
                                                <span class="pl-tag-source pl-tag-link">Source D</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (stage === 4) {
                    stageDiv.innerHTML = `
                        <div class="pl-section">
                            <h3 class="pl-section-title">
                                Coverage Angles
                                <span class="pl-badge">1</span>
                            </h3>
                            <p class="pl-section-desc">Different approaches in how sources frame this story</p>
                            <div class="pl-list">
                                <div class="pl-list-item">
                                    <p class="pl-list-item-title">Angle: Economic implications vs humanitarian impact</p>
                                    <div class="pl-perspective-groups">
                                        <div class="pl-perspective-group">
                                            <div class="pl-group-text">Focuses on the economic impact and market reactions</div>
                                            <div class="pl-group-sources">
                                                <span class="pl-tag-source pl-tag-link">Financial Times</span>
                                                <span class="pl-tag-source pl-tag-link">Wall Street Journal</span>
                                            </div>
                                        </div>
                                        <div class="pl-perspective-group">
                                            <div class="pl-group-text">Emphasizes the humanitarian consequences and personal stories</div>
                                            <div class="pl-group-sources">
                                                <span class="pl-tag-source pl-tag-link">BBC News</span>
                                                <span class="pl-tag-source pl-tag-link">CNN</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="pl-footer" class="pl-footer">
                                <div class="pl-footer-stats">
                                    <span class="pl-footer-stat">
                                        <strong>8</strong> sources analyzed
                                    </span>
                                    <span class="pl-footer-stat">
                                        <strong>15.2s</strong> analysis time
                                    </span>
                                </div>
                                <button id="pl-view-perspectives" class="pl-btn-link">
                                    View all 8 perspectives â†’
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                content.appendChild(stageDiv);
            },
            showAnalysis: function(analysis) {
                // Simulate complete analysis display
                console.log('Complete analysis:', analysis);
                
                // Mark all stages as completed
                for (let i = 1; i <= 4; i++) {
                    updateStageIndicator(i, 'completed');
                }
                
                // Clear and show complete content (would be implemented in real scenario)
                document.getElementById('pl-content').innerHTML = '<p>Complete analysis would be shown here</p>';
                document.getElementById('pl-content').style.display = 'block';
            },
            reset: function() {
                // Reset the panel UI
                while (document.querySelector('.pl-stage-indicator.active') || document.querySelector('.pl-stage-indicator.completed')) {
                    const active = document.querySelector('.pl-stage-indicator.active');
                    const completed = document.querySelector('.pl-stage-indicator.completed');
                    
                    if (active) active.classList.remove('active');
                    if (completed) completed.classList.remove('completed');
                }
                
                document.getElementById('pl-content').innerHTML = '';
                document.getElementById('pl-content').style.display = 'none';
            }
        };

        function updateStageIndicator(stage, status) {
            const indicator = document.querySelector(`.pl-stage-indicator[data-stage="${stage}"]`);
            if (!indicator) return;
            
            // Reset classes
            indicator.classList.remove('active', 'completed');
            
            // Add appropriate class
            if (status === 'active') {
                indicator.classList.add('active');
            } else if (status === 'completed') {
                indicator.classList.add('completed');
            }
        }

        function openPanel() {
            window.PerspectiveLensPanel.show();
        }

        function simulateStage1() {
            window.PerspectiveLensPanel.showAnalysisProgressive(1, {
                story_summary: "This is a summary of the news article",
                trust_signal: "high_agreement",
                reader_action: "Pay attention to potential bias in the sources"
            }, []);
        }

        function simulateStage2() {
            window.PerspectiveLensPanel.showAnalysisProgressive(2, {
                consensus: [
                    { fact: "Fact 1: This is a fact that multiple sources agree on", sources: ["Source A", "Source B", "Source C"] },
                    { fact: "Fact 2: This is another fact that all sources confirm", sources: ["Source A", "Source B", "Source D", "Source E"] }
                ]
            }, []);
        }

        function simulateStage3() {
            window.PerspectiveLensPanel.showAnalysisProgressive(3, {
                factual_disputes: [
                    { 
                        what: "Disputed claim about the event timeline",
                        claim_a: "The event occurred at 3 PM local time",
                        claim_b: "The event occurred at 5 PM local time",
                        sources_a: ["Source A", "Source B"],
                        sources_b: ["Source C", "Source D"]
                    }
                ]
            }, []);
        }

        function simulateStage4() {
            window.PerspectiveLensPanel.showAnalysisProgressive(4, {
                coverage_angles: [
                    { 
                        angle: "Angle: Economic implications vs humanitarian impact",
                        group1: "Focuses on the economic impact and market reactions",
                        group1_sources: ["Financial Times", "Wall Street Journal"],
                        group2: "Emphasizes the humanitarian consequences and personal stories",
                        group2_sources: ["BBC News", "CNN"]
                    }
                ]
            }, []);
        }

        function showComplete() {
            window.PerspectiveLensPanel.showAnalysis({
                story_summary: "This is a summary of the news article",
                trust_signal: "high_agreement", 
                reader_action: "Pay attention to potential bias in the sources",
                consensus: [
                    { fact: "Fact 1: This is a fact that multiple sources agree on", sources: ["Source A", "Source B", "Source C"] },
                    { fact: "Fact 2: This is another fact that all sources confirm", sources: ["Source A", "Source B", "Source D", "Source E"] }
                ],
                factual_disputes: [
                    { 
                        what: "Disputed claim about the event timeline",
                        claim_a: "The event occurred at 3 PM local time",
                        claim_b: "The event occurred at 5 PM local time",
                        sources_a: ["Source A", "Source B"],
                        sources_b: ["Source C", "Source D"]
                    }
                ],
                coverage_angles: [
                    { 
                        angle: "Angle: Economic implications vs humanitarian impact",
                        group1: "Focuses on the economic impact and market reactions",
                        group1_sources: ["Financial Times", "Wall Street Journal"],
                        group2: "Emphasizes the humanitarian consequences and personal stories",
                        group2_sources: ["BBC News", "CNN"]
                    }
                ],
                metadata: {
                    articlesAnalyzed: 8,
                    totalDuration: 15200
                },
                perspectives: Array(8).fill({ source: "Sample Source", country: "US" })
            });
        }

        function resetPanel() {
            window.PerspectiveLensPanel.reset();
        }
    </script>
</body>
</html>